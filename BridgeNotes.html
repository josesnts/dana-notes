<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bridge Call Recorder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <style>
    body { padding: 2rem; }
    #notesList { white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4">Bridge Call Recorder</h2>
    <div class="mb-3">
      <textarea id="noteInput" class="form-control" rows="4" placeholder="Start typing your meeting note..."></textarea>
    </div>
    <button id="logNoteBtn" class="btn btn-primary mb-3">Log Note</button>
    <button id="copyBtn" class="btn btn-secondary mb-3">Copy All to Clipboard</button>
    <h5>Logged Notes:</h5>
    <div id="notesList" class="border p-3 bg-light"></div>
  </div>

<script>
  let typingStartTime = null;
  const noteInput = document.getElementById('noteInput');
  const notesList = document.getElementById('notesList');
  const logNoteBtn = document.getElementById('logNoteBtn');
  const copyBtn = document.getElementById('copyBtn');

  noteInput.addEventListener('input', () => {
    if (!typingStartTime) {
      typingStartTime = new Date(); // Just mark the moment
    }
  });

  logNoteBtn.addEventListener('click', () => {
    if (!noteInput.value.trim()) return;

    // Format directly in America/New_York timezone
    const dateString = new Intl.DateTimeFormat('en-US', {
      timeZone: 'America/New_York',
      month: '2-digit',
      day: '2-digit',
      year: 'numeric'
    }).format(typingStartTime);

    const timeString = new Intl.DateTimeFormat('en-US', {
      timeZone: 'America/New_York',
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    }).format(typingStartTime);

    const tzAbbr = new Intl.DateTimeFormat('en-US', {
      timeZone: 'America/New_York',
      timeZoneName: 'short'
    }).formatToParts(typingStartTime).find(part => part.type === 'timeZoneName').value;

    const timestamp = `[${dateString} - ${timeString} ${tzAbbr}]`;
    const note = `${timestamp} - ${noteInput.value.trim()}`;

    notesList.textContent += note + '\n';
    noteInput.value = '';
    typingStartTime = null;
  });

  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(notesList.textContent)
      .then(() => alert('Notes copied to clipboard!'))
      .catch(err => alert('Failed to copy notes.'));
  });
</script>

</body>
</html>